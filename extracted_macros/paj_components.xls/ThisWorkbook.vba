Attribute VB_Name = "ThisWorkbook"Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"Attribute VB_Creatable = FalseAttribute VB_PredeclaredId = TrueAttribute VB_Exposed = TrueAttribute VB_TemplateDerived = FalseAttribute VB_Customizable = TrueOption ExplicitOption Base 1Private Sub workbook_Open()    add_ormm_menu "Do it Yourself", "PAJ_checkmenu"     PAJ_checkmenuEnd SubPrivate Sub workbook_beforeclose(Cancel As Boolean)    delete_ormm_menu "Do it Yourself"End SubPrivate Sub add_ormm_menu(newMethod, newAction)    Dim OR_MMmenu As Boolean, Newmenu As Boolean    Dim rmenu As Object, mitem As Object, NewItem As Object, NewToolsItem As Object    OR_MMmenu = False    'find OR_MM menu.  Add it if its not present    For Each rmenu In MenuBars(xlWorksheet).Menus        If rmenu.Caption = "OR_MM" Then OR_MMmenu = True    Next rmenu        If OR_MMmenu = False Then        Set NewToolsItem = MenuBars(xlWorksheet).Menus.Add(Caption:="OR_MM")        'Set NewItem = MenuBars(xlWorksheet) _        .Menus("OR_MM").MenuItems.Add(Caption:="Credits", OnAction:="CreditsSub")    End If    'add method to OR_MM menu if necessary    Newmenu = False    For Each mitem In MenuBars(xlWorksheet).Menus("OR_MM").MenuItems        If mitem.Caption = newMethod Then Newmenu = True    Next mitem        If Newmenu = False Then        Set NewItem = MenuBars(xlWorksheet) _        .Menus("OR_MM").MenuItems.Add(Caption:=newMethod, OnAction:=newAction, before:=putindex(newMethod))        NewItem.Checked = False    End IfEnd SubPrivate Sub delete_ormm_menu(newMethod)    Dim rmenu As Object, amenu As Object    Dim itemcount As Integer   'find OR_MM menu.    For Each rmenu In MenuBars(xlWorksheet).Menus        If rmenu.Caption = "OR_MM" Then            For Each amenu In MenuBars(xlWorksheet).Menus("OR_MM").MenuItems    'find items on OR_MM menu related to add-in and delete them                If amenu.Caption = newMethod Then                    With MenuBars(xlWorksheet).Menus("OR_MM").MenuItems(newMethod)                         If .Checked Then                            delete_ormm_items newMethod                            .Checked = False                        End If                       itemcount = MenuBars(xlWorksheet).Menus("OR_MM").MenuItems.Count                        If itemcount < 3 Then                            MenuBars(xlWorksheet).Menus("OR_MM").Delete                        Else                            .Delete                        End If                        Exit Sub                    End With                End If            Next amenu        End If    Next rmenuEnd SubPrivate Sub delete_ormm_items(newMethod)    Dim delete_more As Boolean    Dim rmenu As Object    Dim x As String    'find items on OR_MM menu related to add-in and delete them    delete_more = False    For Each rmenu In MenuBars(xlWorksheet).Menus("OR_MM").MenuItems        If rmenu.Caption = newMethod Then            delete_more = True        Else            If delete_more Then               x = rmenu.Caption                If Left(x, 1) = "_" Then                    rmenu.Delete                Else                    delete_more = False: Exit For                End If            End If        End If    NextEnd SubPrivate Function putindex(newMethod) As Integer    Dim k_array As Integer, addin_titles, mitem, I_Quit As Boolean, my_caption As String        addin_titles = Array("Add ORMM...", "Math Programming", "LP Solver...", "LP/IP Solver...", "MP Solver...", "MP Methods...", "Network Solver...", "Net Solver...", "Net Methods...", _        "Random Variables", "Markov Chain", "Markov Process", "Queues", "Forecast", "Forecast", "Decision Analysis", _        "Teach LP", "Teach Network", "Teach Transportation", "Teach IP", "Teach NLP", "Teach DP")    putindex = 1    k_array = 1    For Each mitem In MenuBars(xlWorksheet).Menus("OR_MM").MenuItems                my_caption = mitem.Caption        If my_caption = "Credits" Then Exit Function 'We reached the end of the list put it before credits        If my_caption = newMethod Then putindex = 0: Exit Function 'the add-in is already on the list        If Left(my_caption, 1) <> "_" Then            I_Quit = False            Do Until I_Quit Or k_array > UBound(addin_titles)            'advance title counter until the caption is a name on the list or newMethod is found                If addin_titles(k_array) = newMethod Then Exit Function 'put the add-in name at the current location                If my_caption = addin_titles(k_array) Then I_Quit = True 'found a title on the list                k_array = k_array + 1            Loop                    End If        putindex = putindex + 1    Next mitemEnd Function